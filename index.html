<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TzyMusic</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root{
  --primary:#a855f7;
  --bg:#030014;
  --card-bg:rgba(17,25,40,.85);
  --border:rgba(255,255,255,.08);
  --text:#fff;
  --muted:#94a3b8;
  --highlight:#22c55e;
}
*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',sans-serif}
body{background:var(--bg);color:var(--text);padding-bottom:180px;}
.grid-bg{
  position:fixed;inset:0;
  background:
    linear-gradient(rgba(255,255,255,.03) 1px,transparent 1px),
    linear-gradient(90deg,rgba(255,255,255,.03) 1px,transparent 1px);
  background-size:30px 30px;
  z-index:-1;
}
.main{padding:24px;}
.header h1{font-size:32px;margin-bottom:6px;background:linear-gradient(to right,#fff,var(--primary));-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.header-desc{color:var(--muted);margin-bottom:20px;font-size:14px}

/* MENU */
.menu-grid{display:flex;gap:12px;margin-bottom:16px}
.menu-btn{
  flex:1;text-align:center;padding:14px 0;border-radius:16px;
  background:var(--card-bg);border:1px solid var(--border);
  color:var(--highlight);font-weight:600;text-decoration:none;transition:.3s;
  cursor:pointer;position:relative;
}
.menu-btn:hover{background:#0f172a;transform:translateY(-3px);box-shadow:0 8px 20px rgba(0,0,0,.4)}
.menu-btn i{margin-right:6px;}

/* SEARCH */
.search-bar{margin-bottom:16px;position:relative;}
.search-bar input{
  width:100%;padding:12px 16px;border-radius:16px;border:none;font-size:14px;
  background:var(--card-bg);color:var(--text);
  transition:.3s;
}
.search-bar input:focus{outline:none;box-shadow:0 0 10px var(--primary);}

/* PLAYLIST */
.playlist{display:grid;grid-template-columns:repeat(auto-fill,minmax(170px,1fr));gap:20px}
.card{
  background:var(--card-bg);border-radius:16px;padding:14px;cursor:pointer;
  transition:.3s;box-shadow:0 10px 30px rgba(0,0,0,.3);position:relative;
}
.card:hover{transform:translateY(-5px) scale(1.03);background:#020617;box-shadow:0 12px 30px rgba(0,0,0,.5)}
.card img{width:100%;border-radius:12px;margin-bottom:10px}
.card h4{font-size:16px}
.card p{font-size:13px;color:var(--muted)}
.badge-new{position:absolute;top:10px;right:10px;background:#ef4444;color:#fff;font-size:10px;padding:2px 6px;border-radius:10px}

/* PLAYER */
.player{position:fixed;left:0;right:0;bottom:0;background:rgba(2,6,23,.95);backdrop-filter:blur(12px);border-top:1px solid #1e293b;padding:14px 22px;z-index:99}
.player-top{display:flex;align-items:center;justify-content:space-between;gap:12px}
.song-info{display:flex;align-items:center;gap:14px}
.song-info img{width:64px;height:64px;border-radius:50%}
.controls{display:flex;align-items:center;gap:10px}
.controls button{
  background:none;border:none;color:var(--highlight);font-size:20px;width:46px;height:46px;border-radius:50%;cursor:pointer;transition:.3s;
}
.controls button:hover{color:#4ade80;transform:scale(1.1);}
.time-row{display:flex;justify-content:space-between;font-size:12px;color:var(--muted);margin:6px 2px}
.progress{width:100%;height:6px;background:#1e293b;border-radius:10px;cursor:pointer;position:relative}
.progress-bar{height:100%;width:0%;background:var(--highlight);border-radius:10px;transition:.2s}
.volume-control{position:relative;display:flex;align-items:center;gap:4px}
.volume-slider{display:none;position:absolute;bottom:50px;right:0;width:100px;height:6px;background:#1e293b;border-radius:6px;cursor:pointer}
.volume-slider input[type=range]{width:100%;height:6px;background:var(--highlight);cursor:pointer;border-radius:6px}
.rotate.playing{animation:spin 6s linear infinite}
@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}
@media(max-width:768px){.player-top{flex-direction:column;align-items:flex-start}}
</style>
</head>
<body>
<div class="grid-bg"></div>
<div class="main">
  <div class="header">
    <h1>TzyMusic</h1>
    <div class="header-desc">Nikmati koleksi musik favoritmu langsung di browser</div>
  </div>

  <div class="menu-grid">
    <a href="info.html" class="menu-btn"><i class="fa-solid fa-circle-info"></i> Info</a>
    <a href="req.html" class="menu-btn"><i class="fa-solid fa-music"></i> Request Musik</a>
  </div>

  <div class="search-bar">
    <input type="text" id="searchInput" placeholder="Cari musik...">
  </div>

  <div class="playlist" id="playlist"></div>
</div>

<div class="player">
  <div class="player-top">
    <div class="song-info">
      <img id="cover" class="rotate"/>
      <div>
        <div id="title">Pilih Lagu</div>
        <small id="artist"></small>
      </div>
    </div>
    <div class="controls">
      <button onclick="prevSong()"><i class="fa-solid fa-backward-step"></i></button>
      <button onclick="togglePlay()" id="playBtn"><i class="fa-solid fa-play"></i></button>
      <button onclick="nextSong()"><i class="fa-solid fa-forward-step"></i></button>
      <div class="volume-control">
        <i class="fa-solid fa-volume-high" id="volumeBtn" onclick="toggleVolume()"></i>
        <div class="volume-slider" id="volumeSlider">
          <input type="range" min="0" max="1" step="0.01" value="1" id="volRange">
        </div>
      </div>
    </div>
  </div>
  <div class="time-row">
    <span id="currentTime">0:00</span>
    <span id="duration">0:00</span>
  </div>
  <div class="progress" id="progress" onmousedown="startSeek(event)">
    <div class="progress-bar" id="progressBar"></div>
  </div>
  <audio id="audio"></audio>
</div>

<script>
let musicList=[],currentIndex=-1,isPlaying=false;
const playlistEl=document.getElementById('playlist');
const audio=document.getElementById('audio');
const titleEl=document.getElementById('title');
const artistEl=document.getElementById('artist');
const coverEl=document.getElementById('cover');
const playBtn=document.getElementById('playBtn');
const progressBar=document.getElementById('progressBar');
const currentTimeEl=document.getElementById('currentTime');
const durationEl=document.getElementById('duration');
const searchInput=document.getElementById('searchInput');
const volumeBtn=document.getElementById('volumeBtn');
const volumeSlider=document.getElementById('volumeSlider');
const volRange=document.getElementById('volRange');
const progress=document.getElementById('progress');

// LOAD MUSIC
fetch('music.json').then(r=>r.json()).then(d=>{musicList=d;renderPlaylist();});

// RENDER PLAYLIST
function renderPlaylist(list=musicList){
  playlistEl.innerHTML='';
  list.forEach((m,i)=>{
    const c=document.createElement('div');
    c.className='card';
    c.innerHTML=`<img src="${m.cover}"><h4>${m.title}</h4><p>${m.artist}</p>`;
    if(i>=list.length-2)c.innerHTML+=`<span class="badge-new">NEW</span>`;
    c.onclick=()=>playSong(i);
    playlistEl.appendChild(c);
  });
}

// PLAY
function playSong(i){
  const m=musicList[i];
  currentIndex=i;
  titleEl.innerText=m.title;
  artistEl.innerText=m.artist;
  coverEl.src=m.cover;
  audio.src=m.audio;
  audio.play();
  isPlaying=true;
  playBtn.innerHTML='<i class="fa-solid fa-pause"></i>';
  coverEl.classList.add('playing');
  localStorage.setItem('currentSong',i);
}

// TOGGLE PLAY
function togglePlay(){
  if(!audio.src)return;
  if(isPlaying){audio.pause();playBtn.innerHTML='<i class="fa-solid fa-play"></i>';coverEl.classList.remove('playing');}
  else{audio.play();playBtn.innerHTML='<i class="fa-solid fa-pause"></i>';coverEl.classList.add('playing');}
  isPlaying=!isPlaying;
}

// NEXT/PREV
function nextSong(){if(currentIndex<musicList.length-1)playSong(currentIndex+1);}
function prevSong(){if(currentIndex>0)playSong(currentIndex-1);}
audio.onended=()=>{nextSong();}

// PROGRESS
audio.ontimeupdate=()=>{if(!audio.duration)return;progressBar.style.width=(audio.currentTime/audio.duration)*100+'%';currentTimeEl.innerText=formatTime(audio.currentTime);}
audio.onloadedmetadata=()=>{durationEl.innerText=formatTime(audio.duration);}
function startSeek(e){
  const onMove=(ev)=>{
    const rect=progress.getBoundingClientRect();
    const x=ev.clientX-rect.left;
    audio.currentTime=(x/rect.width)*audio.duration;
  };
  onMove(e);
  const moveHandler=(ev)=>onMove(ev);
  const upHandler=()=>{document.removeEventListener('mousemove',moveHandler);document.removeEventListener('mouseup',upHandler);}
  document.addEventListener('mousemove',moveHandler);
  document.addEventListener('mouseup',upHandler);
}
function formatTime(t){const m=Math.floor(t/60);const s=Math.floor(t%60).toString().padStart(2,'0');return `${m}:${s}`;}

// SEARCH
searchInput.addEventListener('input',()=>{
  const query=searchInput.value.toLowerCase();
  renderPlaylist(musicList.filter(m=>m.title.toLowerCase().includes(query)||m.artist.toLowerCase().includes(query)));
});

// VOLUME
function toggleVolume(){volumeSlider.style.display=volumeSlider.style.display==='block'?'none':'block';}
volRange.addEventListener('input',()=>{audio.volume=volRange.value;});

// RESTORE LAST SONG
window.addEventListener('load',()=>{
  const idx=localStorage.getItem('currentSong');
  if(idx!==null)playSong(Number(idx));
});
</script>
</body>
</html>